<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>routeApp</title>
<style>
html {
	height: 100%;
}
body {
	margin: 0;
	height: 100%;
}
ul, li {
	margin: 0;
}
#app {
	height: 100%;
}
.header {
	height: 50px;
	line-height: 50px;
	font-size: 20px;
	text-align: center;
	color: #fff;
	background-color: gray;
}
.nav {
	position: absolute;
	left: 0;
	top: 50px;
	bottom: 0;
	width: 200px;
	line-height: 30px;
	background-color: yellow;
	text-indent: 2em;
}
.body {
	position: absolute;
	left: 200px;
	right: 0;
	top: 50px;
	bottom: 0;
	background-color: #fff;
	overflow: auto;
}
</style>
</head>
<body ontouchstart ng-controller="mainCtrl">

<div class="header" ng-bind="'WELCOME' | translate"></div>

<div class="nav">
	<div ng-repeat="n in menus">
		<a ui-sref="{{ n.name }}" ng-bind="n.text"></a>

		<ul ng-if="n.children && n.children.length">
			<li ng-repeat="m in n.children">
				<a ui-sref="{{ m.name }}" ng-bind="m.text"></a>
			</li>
		</ul>
	</div>
</div>

<div class="body">
	<ui-view></ui-view>
</div>

<script src="js/lib/require.js"></script>
<script src="js/require.config.js"></script>
<script>
require(['routeApp', 'i18n'], function(routeApp, i18n) {

	routeApp.module.requires.push('i18n');

	var routes = [{
		text: 'Home',
		name: 'home',
		component: 'page/home',
		hasjs: false,
		from: '*'
	}, {
		text: 'Go to Foo',
		name: 'foo',
		component: 'page/foo',

		children: [{
			text: 'Go to Bar',
			name: 'bar',
			path: 'foo/bar',
			component: 'page/bar',
			from: '/bar/*'
		}]
	}];

	routeApp.module.controller('mainCtrl', function($scope) {
		$scope.menus = routes;
	});

	routeApp.change(function(e, toState, toParams, fromState, fromParams) {
		console.log('从 ' + fromState.name + ' 跳转到 ' + toState.name)
	});

	routeApp.install(routes);
	routeApp.start();

	i18n.setLangType('zh-CN', 'data/i18n/zh-CN.json')
		.then(function() {
			console.log(i18n.getLang('WELCOME'));
			alert('5 秒后切换英语');
		});

	setTimeout(function() {
		i18n.setLangType('en-US', 'data/i18n/en-US.json')
			.then(function() {
				console.log(i18n.getLang('WELCOME'));
			});
	}, 5000);

});
</script>
</body>
</html>
